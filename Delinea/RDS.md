# RDS Setup Guide
Delinea RDS Setup guide
> OS: Window Server 2019

***
## Overview
>The Secret Server Session Connector (SSSC) allows you to launch remote sessions (like RDP or SSH) without needing extra software on your computer. This is done using a Remote Desktop Services (RDS) server that takes care of everything.

![RDS-flow](Delinea\PIC\RDS.png)


## Prerequisites

* *Before you install and configure RDS, you need to ensure that file and printer sharing is enabled on the RDS server.*

    ### Steps to enable file and printer sharing:

    1) Access Network and Sharing Center: Go to the Network and Sharing Center on the RDS server.  
    2) Advanced Sharing Settings: Open the advanced sharing settings.  
    3) Enable File and Printer Sharing: Make sure that file and printer sharing is turned on.  

* *Each RDS server needs to have a recent version of the C++ redistributable installed*
    >Version: v14.26.28720 or higher, May 2020

* *You need a user account (credential) with permissions to manage local users on the RDS server.*

* *The Default Domain Policy should be set to allow the "Log on as a batch job" permission.*

    >Log on as a batch job: This is a user right that allows accounts to log on using a batch-queue facility. Typical uses of this right include tasks scheduled to run on behalf of a user and processes run on behalf of a user without requiring the user to be logged on.  

    ### Steps to Grant "Log on as a batch job" Permission:

    1) Open Group Policy Management:  
    On a domain controller or a computer with the Group Policy Management Console installed, open the Group Policy Management tool.  


    2) Edit the Default Domain Policy:  
    Navigate to Group Policy Management > Forest > Domains > [Your Domain] > Default Domain Policy.  
    Right-click the Default Domain Policy and select Edit.

    3) Navigate to User Rights Assignment:  
    In the Group Policy Management Editor, go to Computer Configuration > Policies > Windows Settings > Security Settings > Local Policies > User Rights Assignment.  

    4) Configure Log on as a batch job:   
    Find the policy Log on as a batch job in the list.
    Double-click it and add the necessary user or group that the SSSC will use to this policy.
    Click OK to save the changes.

* *Activate the Remote Desktop Services license server*.  
    >[LINK](https://learn.microsoft.com/en-us/windows-server/remote/remote-desktop-services/rds-activate-license-server)  

##  Installing Remote Desktop Services

1) In Server Manager, click Add roles and Features. The Add Role and Features wizard appears.
2) Select Role-based or feature-based installation.
3) Click to select the check boxes for *Remote Desktop Services*.
4) Click to select the check boxes for *Remote Desktop Connection Broker*, *Remote Desktop Session Host* and *Remote Desktop Web Access roles*.

    > The Remote Desktop Connection Broker (RD Connection Broker):  
    is responsible for connecting users to their sessions.  

    >  The Remote Desktop Session Host (RDSH):  
     It enables a server to host Windows-based programs or the full Windows desktop for Remote Desktop Services clients. 

    > Remote Desktop Web Access (RD Web Access):  
    enables users to access RemoteApp and Desktop Connection through a web browser.

5) Click the Install button.

## Configuring Session Connector Settings

1) Go to https://**Your Secret Server location**/ConfigurationAdvanced.aspx
   >Example:  
   If you use: https://finn3tsky.delinea.app/view/auth/start  
   Change it to: https://finn3tsky.secretservercloud.com.sg/ConfigurationAdvanced.aspx  
   
   Or you can copy it from here.

   ```
   .secretservercloud.com.sg/ConfigurationAdvanced.aspx
   ```
   
2) Set Session Connector to True.
3) (Optional) Set Session Connector Session Timeout if you do not want to use the 900-second default (15 minutes). 
    >Example:  
    If you set the timeout to 300 seconds (5 minutes), the .RDP file generated by SSSC will only be valid for 5 minutes after it's generated. After that, users would need to generate a new .RDP file to connect again.
4) (Optional) Set Session Connector Allow Connection Sharing to True.
    >  If set to true, it enables connection sharing. This means when multiple users launch sessions into the same RDS server, the SSSC may attempt to reuse existing Windows sessions rather than always creating new ones.

5) Click the Save button.

## Setting up RDS in Secret Server

1) Enable the Session Connector Advanced Configuration Setting
2) Ensure Secret Server Custom URL is Set
In Secret Server's  
Admin > Configuration > General tab.
    > Set a valid HTTPS URL for Secret Server, which is used by SSPH launches (including SSSC and RDS SSPH) to establish connectivity back to Secret Server.
3) Create a Secret for the RDS Credentials mentioned above. If the credential is a local account, use a Windows Local Account secret, and if it is a domain user, use an Active Directory secret.
4) Create application users in Secret Server, one for each of the RDS server machines.
5) Share the secret created for the RDS credential mentioned above with the RDS application accounts
6) Create SSSC Custom Launchers
   >Example:  
   For RDP sessions, configure a custom launcher that uses the built-in RDP launcher as its child launcher. This customization allows for specific settings and behaviors when launching sessions.
7) Assign SSSC Custom Launchers to Secret Templates

## Creating RDS Application Accounts
On Secret Server page.
```
.secretservercloud.com.sg/ConfigurationAdvanced.aspx
```
1) Go to Admin > Users
2) Click the Create New button.
3) Type in or set the account details.
4) Ensure that the Enabled check box is selected.
5) Click the Advanced link. Additional parameters appear:  
Two Factor and Managed By controls set to their defaults, **None**
6) Click to select the Application Account check box. As an application account, the user can only log on through the application account API and does not require a separate user license.
7) Click the Save button. (Repeat this process for each RDS server.)

## Enabling Application Account RDS Credential Sharing

Each RDS application account must have view access to the RDS Credential that the RDS server(s) use to manage the temporary Windows local accounts.

1) Go to the RDS credential secret you created earlier
2) Click the Sharing tab:
3) Grant view access to the applicable application account users. That is usually one Secret Server user account per RDS server. If you are using a cluster, this secret would be an Active Directory secret for a domain credential that all the RDS servers can use, and you would share it with each of the RDS application accounts for each RDS Server in the cluster using in their SSSC configuration.

## Configuring Session Connector Custom Launchers

You must create a custom launcher for each combination of and RDS server cluster and custom launcher type.

1) Go to Admin > Secret Templates.
2) Click the Configure Launchers button. The Launcher Types page appears.
3) Click the New button.
4) Type or set the parameters as follows:  
   * Launcher Type:  
   Session Connector Launcher. This launcher type will not be visible until the Configuration Advanced Setting is enabled.  
   * Active: Ensure this is selected.  
   * Record Keystrokes: Check to record keystrokes in addition to video on related secrets with session monitoring enabled.  
   * Child Launcher Type: Click to select the launcher type, such as Remote Desktop or PuTTY. This is the real launcher type that runs on the RDS server to connect to the secret.
   * RDS Server Hostname: IP or hostname for the RDS server or cluster.
   * RDS Server Port: Type the port. The default RDP port is TCP 3389.
   * RDS Server Credentials: Click the RDS Credentials link to pick the Secret configured above for credentials that can create and delete local users. If RDS Server Hostname points to a cluster, all servers must be able to use these credentials.

## Assigning Session Connector Custom Launchers to Secret Templates
1) Go to Admin > Secret Templates. The Manage Secret Templates page appears
2) Click the unlabeled dropdown to select a secret template that you want to allow SSSC to launch from.
3) Configure Launchers button at the bottom of the page to open the launcher mappings.
4) Click to select the desired parameters for the launcher.
5) All secrets using this template are now ready to run SSSC launches.

## Setup RDS server
1) Go to Tools > Launcher Tools to download the launcher application. Click the 'Download Protocol Handler (64-bit, Session Connector RDS edition) MSI'
2) you may need to allowlist the RDPWin.exe file (the primary executable for SSPH) in any antivirus software.

## Adding the Remote Desktop Collection and Application

You can following these step in document
>[LINK](https://docs.delinea.com/online-help/secret-server/secret-launchers/session-connector/index.htm#Task3SettingupRDS)